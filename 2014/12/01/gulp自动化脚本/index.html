<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> gulp自动化脚本 · Web前端爱好者</title><meta name="description" content="gulp自动化脚本 - SkyCai"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://cnt1992.github.io/atom.xml" title="Web前端爱好者"><meta name="generator" content="Hexo 7.0.0"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/cnt1992" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><span style="display:none !important;"><span id="busuanzi_container_page_pv">本文总阅读量<span id="busuanzi_value_page_pv"></span></span></span><article class="post-block"><h1 class="post-title">gulp自动化脚本</h1><div class="post-info">2014年12月1日</div><div class="post-content"><p>上周腾讯<a href="http://tgideas.qq.com/">TGideas</a>团队来公司分享了一个gulp前端构建利器，自个儿玩了一下，于是有了此文。</p>
<p>号称新一代前端构建利器的<a href="https://github.com/gulpjs/gulp/blob/master/docs/getting-started.md">gulp</a>是基于流的，代码优于配置的构建工具。虽然已经熟悉用<a href="http://gruntjs.cn/getting-started/">grunt</a>来配置构建，但用了gulp之后感觉这个gulp似乎更胜一筹。</p>
<span id="more"></span>

<p>关于如何全局安装<a href="https://github.com/gulpjs/gulp/blob/master/docs/getting-started.md">gulp</a>，该项目<a href="https://github.com/gulpjs/gulp/blob/master/docs/getting-started.md">官网</a>已经有详细的介绍，这里不多赘述，直接进入主题。</p>
<h3 id="利用npm创建package-json文件"><a href="#利用npm创建package-json文件" class="headerlink" title="利用npm创建package.json文件"></a>利用npm创建package.json文件</h3><p>如果对package.json文件已经比较熟悉了，那就没有必要利用这个”引导式”的方式创建package.json，这里是针对”懒人”(比如我…)比较好的方式。切换到项目根目录下面，在终端敲入下面代码:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>
<p>接下来只需按照提示一步步填写，一分钟不到就搞定了。</p>
<h3 id="安装所需的插件并且自动写入package-json文件"><a href="#安装所需的插件并且自动写入package-json文件" class="headerlink" title="安装所需的插件并且自动写入package.json文件"></a>安装所需的插件并且自动写入package.json文件</h3><p>在<a href="https://www.npmjs.org/">npm官网</a>或者到gulp的<a href="http://gulpjs.com/plugins/">插件官网</a>可以查询你所需要的插件关键词，假设输入imagemin，可以看到下载量最多并且属于gulp的一般就是你想要的那个了，然后在终端敲入以下代码下载插件并且自动保存到package.json文件的devDependencies里面去，避免自己手动输入。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">npm install --save-dev gulp-imagemin</span><br></pre></td></tr></table></figure>
<p>如果mac或者linux系统的可能会提示权限不足，暴力一点sudo解决。</p>
<h3 id="创建gulpfile-js文件"><a href="#创建gulpfile-js文件" class="headerlink" title="创建gulpfile.js文件"></a>创建gulpfile.js文件</h3><p>这个是gulp的核心配置文件，配置模式也很简单，基本是下面这种模式</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;任务名称&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;任务路径&#x27;</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>()</span><br><span class="line">        .<span class="title function_">pipe</span>()</span><br><span class="line">        ...</span><br><span class="line">        .<span class="title function_">dest</span>()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="简单的gulpfile-js例子"><a href="#简单的gulpfile-js例子" class="headerlink" title="简单的gulpfile.js例子"></a>简单的gulpfile.js例子</h3><p>这里给了自己写的一个简单gulpfile.js的配置，项目结构如下：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">root</span><br><span class="line">    css</span><br><span class="line">        images</span><br><span class="line">            xxx<span class="selector-class">.png</span></span><br><span class="line">            yyy<span class="selector-class">.png</span></span><br><span class="line">            ...</span><br><span class="line">        xxx<span class="selector-class">.css</span></span><br><span class="line">        yyy<span class="selector-class">.css</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="selector-tag">html</span></span><br><span class="line">        xxx<span class="selector-class">.html</span></span><br><span class="line">        yyy<span class="selector-class">.html</span></span><br><span class="line">        ...</span><br><span class="line">    images</span><br><span class="line">        xxx<span class="selector-class">.png</span></span><br><span class="line">        yyy<span class="selector-class">.jpg</span></span><br><span class="line">        ...</span><br><span class="line">    js</span><br><span class="line">        xxx<span class="selector-class">.js</span></span><br><span class="line">        yyy<span class="selector-class">.js</span></span><br><span class="line">        lib</span><br><span class="line">            jquery<span class="selector-class">.js</span></span><br><span class="line">            jquery<span class="selector-class">.xxx</span>.js</span><br></pre></td></tr></table></figure>

<p>gulpfile.js内容如下(项目结构如果不一样，只需修改配置路径以及输出路径即可)：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> jshint = <span class="built_in">require</span>(<span class="string">&#x27;gulp-jshint&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">&#x27;gulp-uglify&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> stylish = <span class="built_in">require</span>(<span class="string">&#x27;jshint-stylish&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> imagemin = <span class="built_in">require</span>(<span class="string">&#x27;gulp-imagemin&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> pngquant = <span class="built_in">require</span>(<span class="string">&#x27;imagemin-pngquant&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> minifyCSS = <span class="built_in">require</span>(<span class="string">&#x27;gulp-minify-css&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> concat = <span class="built_in">require</span>(<span class="string">&#x27;gulp-concat&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> rename = <span class="built_in">require</span>(<span class="string">&#x27;gulp-rename&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//统一配置路径</span></span><br><span class="line"><span class="keyword">var</span> path = &#123;</span><br><span class="line">    scriptLint : <span class="string">&#x27;./js/*.js&#x27;</span>,</span><br><span class="line">    scriptUglify : <span class="string">&#x27;./js/**/*.js&#x27;</span>,</span><br><span class="line">    styles : <span class="string">&#x27;./css/*.css&#x27;</span>,</span><br><span class="line">    cssImage : <span class="string">&#x27;./css/images/*&#x27;</span>,</span><br><span class="line">    images : <span class="string">&#x27;./images/*&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//统一配置输出路径</span></span><br><span class="line"><span class="keyword">var</span> dest = &#123;</span><br><span class="line">    js : <span class="string">&#x27;./dist/js&#x27;</span>,</span><br><span class="line">    css : <span class="string">&#x27;./dist/css&#x27;</span>,</span><br><span class="line">    cssImage : <span class="string">&#x27;./dist/css/images&#x27;</span>,</span><br><span class="line">    images : <span class="string">&#x27;./dist/images&#x27;</span>,</span><br><span class="line">    html : <span class="string">&#x27;./dist/html&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//全自动执行任务</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;build&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    gulp.<span class="title function_">run</span>(<span class="string">&#x27;lint&#x27;</span>, <span class="string">&#x27;uglify&#x27;</span>, <span class="string">&#x27;imagemin&#x27;</span>, <span class="string">&#x27;css&#x27;</span>, <span class="string">&#x27;css-imagemin&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//js语法检查</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;lint&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(path.<span class="property">scriptLint</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">jshint</span>())</span><br><span class="line">        .<span class="title function_">pipe</span>(jshint.<span class="title function_">reporter</span>(stylish))</span><br><span class="line">        .<span class="title function_">pipe</span>(jshint.<span class="title function_">reporter</span>(<span class="string">&#x27;fail&#x27;</span>))      <span class="comment">//若语法错误过多，自动抛错处理</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//js压缩输出到指定文件夹,若需合并再压缩参考下面css合并压缩任务</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;uglify&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    gulp.<span class="title function_">src</span>(path.<span class="property">scriptUglify</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">uglify</span>())</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(dest.<span class="property">js</span>))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//image压缩输出到指定文件夹</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;imagemin&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(path.<span class="property">cssImage</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">imagemin</span>(&#123;</span><br><span class="line">            progessive : <span class="literal">true</span>,</span><br><span class="line">            svgoPlugins : [&#123;removeViewBox : <span class="literal">false</span>&#125;],</span><br><span class="line">            use : [<span class="title function_">pngquant</span>()]</span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(dest.<span class="property">images</span>))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//合并压缩css到指定文件夹</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;css&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    gulp.<span class="title function_">src</span>(path.<span class="property">styles</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">concat</span>(<span class="string">&#x27;style.css&#x27;</span>))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(dest.<span class="property">css</span>))</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">rename</span>(<span class="string">&#x27;style.min.css&#x27;</span>))</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">minifyCSS</span>(&#123;</span><br><span class="line">            keepBreaks : <span class="literal">true</span>       <span class="comment">//是否保持换行,默认为false</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(dest.<span class="property">css</span>))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//css目录下面的images压缩输出到指定文件夹</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;css-imagemin&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(path.<span class="property">images</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">imagemin</span>(&#123;</span><br><span class="line">            progessive : <span class="literal">true</span>,</span><br><span class="line">            svgoPlugins : [&#123;removeViewBox : <span class="literal">false</span>&#125;],</span><br><span class="line">            use : [<span class="title function_">pngquant</span>()]</span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(dest.<span class="property">cssImage</span>))</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>在根目录下面敲入下面代码，一次执行全自动化流程:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">gulp build</span><br></pre></td></tr></table></figure>
<p>当然你也可以单独执行某个任务：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">gulp imagemin</span><br></pre></td></tr></table></figure>

<h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><p>例子中的gulpfile.js只是一个最简单的demo，没有加入watch文件监听功能，其它额外的功能也没有，具体所需什么功能可以到<a href="https://www.npmjs.org/">npm官网</a>进行查询，总之“授之以鱼，不如授之予渔”。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2015/04/04/%E6%95%B4%E7%90%86%E8%87%AA%E5%B7%B1%E5%B8%B8%E7%94%A8%E7%9A%84%E7%BD%91%E7%AB%99%E8%B5%84%E6%BA%90/" class="prev">PREV</a><a href="/2014/11/10/koa%E4%B8%8B%E4%B8%80%E4%BB%A3nodejs%E6%A1%86%E6%9E%B6/" class="next">NEXT</a></div><div id="gitment_title" onClick="showGitment()" class="gitment_title">显示评论</div><div id="J_commentContainer" style="display:none;"></div><link rel="stylesheet" href="//imsun.github.io/gitment/style/default.css"><script src="//imsun.github.io/gitment/dist/gitment.browser.js"></script><script>const myTheme = {
    render(state, instance) {
        const container = document.createElement('div');
        container.lang = "en-US";
        container.className = 'gitment-container gitment-root-container';
        container.appendChild(instance.renderHeader(state, instance));
        container.appendChild(instance.renderEditor(state, instance));
        container.appendChild(instance.renderComments(state, instance));
        container.appendChild(instance.renderFooter(state, instance));
        return container;
    }
}
function showGitment() {
    document.querySelector('#gitment_title').style.display = 'none';
    document.querySelector('#J_commentContainer').style.display = 'block';
    document.querySelector('#J_commentContainer').classList.add('gitment_container');
    var gitment = new Gitment({
        id: window.location.pathname,
        theme: myTheme,
        owner: 'cnt1992',
        repo: 'cnt1992.github.io',
        oauth: {
            client_id: '09b981847c8a38e58a62',
            client_secret: '1feb91ebe731e68f89af0e6c43928f5f61d0bbf9'
        }
    });
    gitment.render('J_commentContainer');
}</script><div class="copyright"><p>© 2015 - 2024 <a href="https://cnt1992.github.io">SkyCai</a>, Where there is a will there is a way.</p><p style="display:none !important;"><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span><span id="busuanzi_container_site_uv">本站总访客数<span id="busuanzi_value_site_uv"></span>人次</span></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-75181437-1",'auto');ga('send','pageview');</script><script async="" src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>