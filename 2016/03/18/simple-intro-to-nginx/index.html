<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 前端工程师学习Nginx入门篇 · Web前端爱好者</title><meta name="description" content="前端工程师学习Nginx入门篇 - SkyCai"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://cnt1992.github.io/atom.xml" title="Web前端爱好者"><meta name="generator" content="Hexo 7.0.0"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/cnt1992" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><span style="display:none !important;"><span id="busuanzi_container_page_pv">本文总阅读量<span id="busuanzi_value_page_pv"></span></span></span><article class="post-block"><h1 class="post-title">前端工程师学习Nginx入门篇</h1><div class="post-info">2016年3月18日</div><div class="post-content"><p><img src="/img/nginx/nginx.png" alt="Nginx Logo"></p>
<h2 id="What-is-Nginx"><a href="#What-is-Nginx" class="headerlink" title="What is Nginx"></a>What is Nginx</h2><p><code>Nginx</code>(发音：engine X)是一款轻量级的<code>HTTP</code>服务器（相比于Apache、Lighttpd而言），同时是一个高性能的<code>HTTP</code>和<a href="#tips_1">反向代理</a>服务器，如今国内主流网站基本搭建于<code>Nginx</code>之上，诸如新浪、腾讯、网易、豆瓣。</p>
<p><code>Nginx</code>主要以<strong>事件驱动</strong>的方式编写，有兴趣可以移步<a href="https://github.com/nginx/nginx">这里</a>看他们的源码，这让它拥有非常好的性能，同时也是一个非常高效的反向代理、负载均衡（不知道反向代理跟负载均衡的童鞋请自觉移步文章结尾恶补一下）。</p>
<p><a href="http://nginx.org/en/">官方站点</a>也指出了<code>Nginx</code>作为HTTP服务器的几项基本特性：</p>
<ul>
<li>处理静态文件，索引文件以及自动索引；打开文件描述符缓冲</li>
<li>无缓存的反向代理加速，简单的负载均衡和容错</li>
<li>FastCGI，简单的负载均衡和容错</li>
<li>模块化的结构，包括gzipping,byte ranges,chunked responses,以及SSI-filter等filter。</li>
<li>支持SSL和TLSSNI.</li>
</ul>
<p>对于前端童鞋而言，可能基本不会碰到服务器的东西，但如果像我这样子有『全栈工程师』心结的话倒是可以研究一下，自己成功配置Nginx启动自己的服务，以后再碰到这些关于Nginx的问题自己能够解决，丰衣足食~</p>
<p>接下来我将手把手教大家从安装到配置，搭建起Nginx环境，走起~</p>
<span id="more"></span>

<h2 id="安装并启动Nginx"><a href="#安装并启动Nginx" class="headerlink" title="安装并启动Nginx"></a>安装并启动Nginx</h2><p>由于我是用Mac办公的，所以安装<code>Nginx</code>是采用<code>brew</code>进行的，在<code>终端</code>输入下面命令安装好<code>Nginx</code>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 强烈建议每次brew安装软件的时候先执行brew update保持软件依赖包都是最新的</span></span><br><span class="line">brew update &amp;&amp; brew install nginx</span><br></pre></td></tr></table></figure>

<p>紧接着就可以用浏览器打开<a href="http://localhost:8080/">http://localhost:8080</a>看到<code>Nginx</code>的欢迎信息。</p>
<p>跟<code>Linux</code>系统有些不同，在<code>Mac</code>下面<code>Nginx</code>默认监听了<code>8080</code>端口号，若强迫症（比如我）不希望每次打开网页都要输入端口号的话，那么请在<code>终端</code>执行下面命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 下面的1.8.0请根据最新安装版本号对应修改</span></span><br><span class="line">sudo <span class="built_in">chown</span> root:wheel /usr/local/Cellar/nginx/1.8.0/bin/nginx</span><br><span class="line">sudo <span class="built_in">chmod</span> u+s /usr/local/Cellar/nginx/1.8.0/bin/nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用vi编辑器打开nginx配置文件，找到server字段的listen字段并将其值修改为80</span></span><br><span class="line">vi /usr/local/etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>

<p>修改完上面<code>配置信息</code>之后，执行下面命令检查配置文件语法是否有误并且重新加载配置：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nginx -t &amp;&amp; nginx -s reload</span><br></pre></td></tr></table></figure>

<p>更多关于<code>Nginx</code>命令的帮助可以输入<code>nginx -h</code>查看，若想每次开机自动开启<code>Nginx</code>，在<code>终端</code>执行下面命令即可：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ln</span> -sfv /usr/local/opt/nginx/*.plist ~/Library/LaunchAgents</span><br><span class="line">launchctl load ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist</span><br></pre></td></tr></table></figure>

<h2 id="Nginx配置不完全详解"><a href="#Nginx配置不完全详解" class="headerlink" title="Nginx配置不完全详解"></a>Nginx配置不完全详解</h2><p><code>Nginx</code>能否发挥淋漓尽致，就看配置文件了，由于<code>Nginx</code>配置实在太多，不能一一解释，有兴趣移步<a href="http://nginx.org/en/docs/">官方文档</a>。接下来我会给大家解释比较重要的配置，下面是我机器上的<code>Nginx</code>的配置文件（我会带上注释）：</p>
<p>| 强烈建议大家先打开自己的默认Nginx配置跟我的对比来看<br>| 可以在<code>终端</code>执行 <code>cat /usr/local/etc/nginx/nginx.conf.default</code> 查看默认配置文件</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># user字段表明了Nginx服务是由哪个用户哪个群组来负责维护进程的，默认是nobody</span></span><br><span class="line"><span class="comment"># 我这里用了cainengtian用户，staff组来启动并维护进程</span></span><br><span class="line"><span class="comment"># 查看当前用户命令： whoami</span></span><br><span class="line"><span class="comment"># 查看当前用户所属组命令： groups ，当前用户可能有多个所属组，选第一个即可</span></span><br><span class="line"><span class="attribute">user</span> cainengtian staff;</span><br><span class="line"></span><br><span class="line"><span class="comment"># worker_processes字段表示Nginx服务占用的内核数量</span></span><br><span class="line"><span class="comment"># 为了充分利用服务器性能你可以直接写你本机最高内核</span></span><br><span class="line"><span class="comment"># 查看本机最高内核数量命令： sysctl -n hw.ncpu</span></span><br><span class="line"><span class="attribute">worker_processes</span> <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># error_log字段表示Nginx错误日志记录的位置</span></span><br><span class="line"><span class="comment"># 模式选择：debug/info/notice/warn/error/crit</span></span><br><span class="line"><span class="comment"># 上面模式从左到右记录的信息从最详细到最少</span></span><br><span class="line"><span class="attribute">error_log</span>  /usr/local/var/logs/nginx/<span class="literal">error</span>.log <span class="literal">debug</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nginx执行的进程id,默认配置文件是注释了</span></span><br><span class="line"><span class="comment"># 如果上面worker_processes的数量大于1那Nginx就会启动多个进程</span></span><br><span class="line"><span class="comment"># 而发信号的时候需要知道要向哪个进程发信息，不同进程有不同的pid，所以写进文件发信号比较简单</span></span><br><span class="line"><span class="comment"># 你只需要手动创建，比如我下面的位置： touch /usr/local/var/run/nginx.pid</span></span><br><span class="line"><span class="attribute">pid</span>  /usr/local/var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="comment"># 每一个worker进程能并发处理的最大连接数</span></span><br><span class="line">    <span class="comment"># 当作为反向代理服务器，计算公式为： `worker_processes * worker_connections / 4`</span></span><br><span class="line">    <span class="comment"># 当作为HTTP服务器时，公式是除以2</span></span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">2048</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># 关闭错误页面的nginx版本数字，提高安全性</span></span><br><span class="line">    <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 日志记录格式，如果关闭了access_log可以注释掉这段</span></span><br><span class="line">    <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                 &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关闭access_log可以让读取磁盘IO操作更快</span></span><br><span class="line">    <span class="comment"># 当然如果你在学习的过程中可以打开方便查看Nginx的访问日志</span></span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在一个数据包里发送所有头文件，而不是一个接一个的发送</span></span><br><span class="line">    <span class="attribute">tcp_nopush</span>     <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 不要缓存</span></span><br><span class="line">    <span class="attribute">tcp_nodelay</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">gzip</span>  <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">10m</span>;</span><br><span class="line">    <span class="attribute">client_body_buffer_size</span> <span class="number">128k</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关于下面这段在后面紧接着来谈！</span></span><br><span class="line">    <span class="attribute">include</span> /usr/local/etc/nginx/sites-enabled/*;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Nginx配置最佳实践"><a href="#Nginx配置最佳实践" class="headerlink" title="Nginx配置最佳实践"></a>Nginx配置最佳实践</h2><p>上面的<code>配置文件</code>最后一行<code>include</code>关键词会将<code>/usr/local/etc/nginx/sites-enabled/</code>文件夹下面的所有文件都加载进当前的配置文件，这样子就可以将配置文件分离，<code>nginx.conf</code>这个<code>配置文件</code>修改之后以后基本不会修改，配置不同站点的时候只需要在<code>/usr/local/etc/nginx/sites-enabled/</code>不断增加新的文件即可，这是比较好的配置方式。</p>
<p>比如我在<code>/usr/local/etc/nginx/sites-enabled/</code>下面增加了两个文件，用来配置普通的<code>HTTP</code>服务还有<code>HTTPS</code>服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">touch</span> /usr/local/etc/nginx/sites-enabled/default</span><br><span class="line"><span class="built_in">touch</span> /usr/local/etc/nginx/sites-enabled/default-ssl</span><br></pre></td></tr></table></figure>

<h3 id="default配置解析"><a href="#default配置解析" class="headerlink" title="default配置解析"></a>default配置解析</h3><p><code>Nginx</code>整个配置的结构大致如下：</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line">events &#123;</span><br><span class="line">    <span class="string">...</span></span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    <span class="string">...</span></span><br><span class="line">    server &#123;</span><br><span class="line">        <span class="string">...</span></span><br><span class="line">        location xxx &#123;</span><br><span class="line">            <span class="string">...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对比上面我的<code>nginx.conf</code>文件可以知道<code>default</code>文件的内容就是配置<code>server</code>部分的，下面先弄一份最基本的配置（带有详细说明）：</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="comment"># Nginx监听端口号</span></span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="comment"># 服务器的名字，默认为localhost，你也可以写成aotu.jd.com，这样子就可以通过aotu.jd.com来访问</span></span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line">    <span class="comment"># 代码放置的根目录</span></span><br><span class="line">    <span class="attribute">root</span> /var/www/;</span><br><span class="line">    <span class="comment"># 编码</span></span><br><span class="line">    <span class="attribute">charset</span> utf-<span class="number">8</span>;    </span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># index字段声明了解析的后缀名的先后顺序</span></span><br><span class="line">        <span class="comment"># 下面匹配到/的时候默认找后缀名为php的文件，找不到再找html，再找不到就找htm</span></span><br><span class="line">        <span class="attribute">index</span> index.php index.html index.htm;</span><br><span class="line">        <span class="comment"># 自动索引</span></span><br><span class="line">        <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="comment"># 这里引入了解析PHP的东西</span></span><br><span class="line">        <span class="attribute">include</span> /usr/local/etc/nginx/conf.d/php-fpm;</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 404页面跳转到404.html，相对于上面的root目录</span></span><br><span class="line">    <span class="attribute">error_page</span>  <span class="number">404</span>              /<span class="number">404</span>.html;</span><br><span class="line">    <span class="comment"># 403页面跳转到403.html，相对于上面的root目录</span></span><br><span class="line">    <span class="attribute">error_page</span>  <span class="number">403</span>              /<span class="number">403</span>.html;</span><br><span class="line">    <span class="comment"># 50x页面跳转到50x.html</span></span><br><span class="line">    <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">    <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">        <span class="attribute">root</span>   html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的配置的意思就是：访问<a href="http://localhost/">http://localhost</a>『80端口号可以直接省略』的时候会在<code>/var/www/</code>下面找<code>index.php</code>文件，如果没有找到就找<code>index.html</code>，如果再没有找到那就找<code>index.htm</code>，如果还是没有找到的话就<code>404</code>跳转到<code>404.html</code>，如果你刚好将<code>/var/www/</code>设置为<code>root</code>用户访问的话，那么就会直接无访问权限<code>403</code>跳转到<code>403.html</code>。</p>
<p>值得注意的是<code>server</code>字段里面的<code>root</code>字段，这个字段需要跟<code>alias</code>字段区分开来，通过下面两段配置解释一下：</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="meta"># 当用root配置的时候，root后面指定的目录是上级目录</span></span><br><span class="line"><span class="meta"># 并且该上级目录必须含有和location后指定的名称的同名目录，否则404</span></span><br><span class="line"><span class="meta"># root末尾的<span class="string">&quot;/&quot;</span>加不加无所谓</span></span><br><span class="line"><span class="meta"># 下面的配置如果访问站点http:<span class="comment">//localhost/test1访问的就是/var/www/test1目录下的站点信息</span></span></span><br><span class="line">location <span class="keyword">/test1/</span> <span class="punctuation">&#123;</span></span><br><span class="line">    root <span class="keyword">/var/</span>www/<span class="punctuation">;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 如果用alias配置，其后面跟的指定目录是准确的，并且末尾必须加<span class="string">&quot;/&quot;</span>，否则404</span></span><br><span class="line"><span class="meta"># 下面的配置如果访问站点http:<span class="comment">//localhost/test2访问的就是/var/www/目录下的站点信息</span></span></span><br><span class="line">location <span class="keyword">/test2/</span> <span class="punctuation">&#123;</span></span><br><span class="line">    alias <span class="keyword">/var/</span>www/<span class="punctuation">;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>大家在实践过程中注意区分即可，配置之后要是碰到<code>404</code>可以先考虑是否是这个原因。</p>
<h3 id="配置反向代理"><a href="#配置反向代理" class="headerlink" title="配置反向代理"></a>配置反向代理</h3><p>对于前端工程师而言，可能最容易成为<code>全栈</code>的技能就是<code>NodeJS</code>了，当我们用<code>express</code>框架写好了一个<code>Node</code>应用之后，比如启动的时候的访问地址是：<code>http://localhost:3000/</code>，但是在部署到服务器上去之后，我们当然不希望别人这样子访问，最好的情况肯定是隐藏掉端口号。</p>
<p>例如我有一个<code>Node</code>服务的名字是<code>o2blog_wx</code>，在启动<code>Node</code>的时候访问的地址是：<code>http://localhost:3000/</code>，但是对外网我们希望是：<code>http://aotu.jd.com/o2blog_wx</code>，接下来我们将通过<code>Nginx</code>进行配置（带有详细注释）。</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> aotu.jd.com;</span><br><span class="line">    <span class="attribute">root</span> /var/www/;</span><br><span class="line">    <span class="section">location</span> /o2blog_wx/ &#123;</span><br><span class="line">        <span class="comment"># 反向代理我们通过proxy_pass字段来设置</span></span><br><span class="line">        <span class="comment"># 也就是当访问http://aotu.jd.com/o2blog_wx的时候经过Nginx反向代理到服务器上的http://127.0.0.1:3000</span></span><br><span class="line">        <span class="comment"># 同时由于解析到服务器上的时候o2blog_wx这个字段都要处理</span></span><br><span class="line">        <span class="comment"># 所以通过rewrite字段来进行正则匹配替换</span></span><br><span class="line">        <span class="comment"># 也就是http://aotu.jd.com/o2blog_wx/hello经过Nginx解析到服务器变成http://127.0.0.1:3000/hello</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:3000;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/o2blog_wx/(.*)</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置临时跳转"><a href="#配置临时跳转" class="headerlink" title="配置临时跳转"></a>配置临时跳转</h3><p>有时候我们觉得一开始配置的URL不好想换掉，但又不想原先的链接失效，比如一开始对外网的链接是：<a href="http://aotu.jd.com/o2blog_wx/%EF%BC%8C%E5%90%8E%E6%9D%A5%E6%83%B3%E6%94%B9%E6%88%90http://aotu.jd.com/wxblog%EF%BC%8C%E5%8F%88%E4%B8%8D%E6%83%B3%E5%8E%9F%E5%85%88%E7%9A%84%E5%A4%B1%E6%95%88%E3%80%82">http://aotu.jd.com/o2blog_wx/，后来想改成http://aotu.jd.com/wxblog，又不想原先的失效。</a></p>
<p>这个时候可以在<code>Nginx</code>上配置一个<code>302</code>临时跳转，如下（<code>server</code>部分跟前面的一样）：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">location /o2blog_wx/ &#123;</span><br><span class="line">    <span class="comment"># 当匹配到http://aotu.jd.com/o2blog_wx/的时候会跳转到http://aotu.jd.com/wxblog</span></span><br><span class="line">    <span class="built_in">return</span> 302 http://aotu.jd.com/wxblog</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置限制访问"><a href="#配置限制访问" class="headerlink" title="配置限制访问"></a>配置限制访问</h3><p>在一台服务器上的资源不全部都是对外开放的，这个时候就需要通过<code>Nginx</code>配置一个限制访问，比如查看本服务器的<code>PHP</code>信息，我们就可以通过下面配置来实现限制访问：</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 当匹配到/info的时候只允许10.7.101.224访问，其它的全部限制</span></span><br><span class="line"><span class="comment"># 同时改写为/info.php</span></span><br><span class="line"><span class="section">location</span> = /info &#123;</span><br><span class="line">    <span class="attribute">allow</span> <span class="number">10.7.101.224</span>;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">    <span class="attribute">rewrite</span> (.*) /<span class="literal">info</span>.php</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候只有<code>IP</code>为<code>10.7.101.224</code>的机器才可以访问：<a href="http://aotu.jd.com/info%EF%BC%8C%E5%85%B6%E5%AE%83%E6%9C%BA%E5%99%A8%E9%83%BD%E4%BC%9A%60403%60%E6%8B%92%E7%BB%9D%E8%AE%BF%E9%97%AE%EF%BC%81">http://aotu.jd.com/info，其它机器都会`403`拒绝访问！</a></p>
<p>当然最佳的实践是将<code>IP</code>抽取出来变成白名单，这样子就可以实现部分<code>IP</code>可以访问，其它的不能访问。</p>
<h2 id="default-ssl-配置解析"><a href="#default-ssl-配置解析" class="headerlink" title="default-ssl 配置解析"></a>default-ssl 配置解析</h2><p>我们都知道<code>HTTP</code>在传输的过程中都是明文的，这直接导致了在传输的任何一个过程中都容易被窃取信息，所以才有了<code>SSL</code>（安全套接层）以及升级版<code>TLS</code>（传输层安全协议）的出现，其实就是在<code>HTTP</code>应用层给<code>TCP/IP</code>传输层的中间增加了<code>TLS/SSL</code>层，统称为<code>HTTPS</code>。</p>
<p>那如何通过<code>Nginx</code>配置<code>HTTPS</code>站点呢，下面就是<code>default-ssl</code>配置文件的内容（详细解析）：</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="comment"># 默认情况下HTTPS监听443端口</span></span><br><span class="line">    <span class="attribute">listen</span>  <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line">    <span class="attribute">root</span>  /var/www/;</span><br><span class="line">    <span class="comment"># 下面这些都是配置SSL需要的</span></span><br><span class="line">    <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="comment"># 下面两个字段需要的crt利用openssl生成，具体可以看[这里](http://nginx.org/en/docs/http/configuring_https_servers.html)</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> ssl/localhost.crt;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> ssl/localhost.key;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">10m</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_protocols</span> SSLv2 SSLv3 TLSv1;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> = /info &#123;</span><br><span class="line">        <span class="attribute">allow</span> <span class="number">127.0.0.1</span>;</span><br><span class="line">        <span class="attribute">deny</span> all;</span><br><span class="line">        <span class="attribute">rewrite</span> (.*) /<span class="literal">info</span>.php;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> /phpmyadmin/ &#123;</span><br><span class="line">        <span class="attribute">root</span> /usr/local/share/phpmyadmin;</span><br><span class="line">        <span class="attribute">index</span> index.php index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">include</span> /usr/local/etc/nginx/conf.d/php-fpm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">403</span> /<span class="number">403</span>.html;</span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面配置之后，就可以通过<a href="https://localhost/">https://localhost</a>访问我们的<code>Nginx</code>首页了。</p>
<p>当然若要在对外网使用，必须购买第三方信任证书才行，有兴趣的童鞋可以谷歌了解，这里不细谈。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>写到这里，最基本的<code>Nginx</code>配置就基本介绍完了，若按照我上面的配置一步步跟着改，基本上都可以跑起来<code>Nginx</code>服务了吧，若想更加深入学习<code>Nginx</code>的配置，强烈建议看<a href="http://nginx.org/en/docs/">官方文档</a>，写得很清晰明了，还是那句老话：<code>授之以鱼不如授之以渔</code>。</p>
<h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><p>提到<code>反向代理</code>，必然先提到<code>正向代理</code>，正向代理(forward)是一个位于客户端【用户A】和原始服务器(origin server)【服务器B】之间的服务器【代理服务器Z】，为了从原始服务器取得内容，用户A向代理服务器Z发送一个请求并指定目标(服务器B),然后代理服务器Z向服务器B转交请求并将获得的内容返回给客户端。客户端必须要进行一些特别的设置才能使用正向代理。如下图（图来自网络，如有侵权请联系我删除~）：</p>
<p><img src="/img/nginx/forwards_proxy.jpg" alt="正向代理示意图"></p>
<p>从上图可以看出，所谓的<code>正向代理</code>就是<code>代理服务器替代访问方【用户A】去访问目标服务器【服务器B】</code>，在现实中的例子就是『翻墙』！但如果代理服务器Z被完全控制（或不完全控制），就变成了『肉鸡』了。</p>
<p>而<code>反向代理</code>与正向代理相反，对客户端而言代理服务器就像是原始服务器，并且客户端不需要进行任何特别的设置。客户端向反向代理的命名空间（name-space）中的内容发送普通请求，接着反向代理将判断向何处（原始服务器）转交请求，并将获得的内容返回给客户端。</p>
<p>使用反向代理服务器主要核心作用如下：</p>
<ol>
<li>保护和隐藏原始资源服务器</li>
</ol>
<p><img src="/img/nginx/backward_proxy_1.jpg" alt="反向代理原理图"></p>
<p>从上图可以看出，用户A始终认为它访问的是代理服务器Z而不是原始服务器B，但实际上反向代理服务器接受用户A的应答，从原始资源服务器B中取得用户A的需求资源，然后发送给用户A。由于防火墙的作用，只允许代理服务器Z访问原始资源服务器B。尽管在这个虚拟的环境下，防火墙和反向代理的共同作用保护了原始资源服务器B，但用户A并不知情。</p>
<ol start="2">
<li>负载均衡</li>
</ol>
<p><img src="/img/nginx/backward_balance.jpg" alt="反向代理负载均衡示例图"></p>
<p>当反向代理服务器不止一个的时候，我们甚至可以把它们做成集群，当更多的用户访问资源服务器B的时候，让不同的代理服务器Z（x）去应答不同的用户，然后发送不同用户需要的资源。</p>
<p>当然<code>反向代理服务器</code>像<code>正向代理服务器</code>一样拥有CACHE的作用，它可以缓存原始资源服务器B的资源，而不是每次都要向原始资源服务器B请求数据，特别是一些静态的数据，比如图片和文件，如果这些反向代理服务器能够做到和用户X来自同一个网络，那么用户X访问反向代理服务器X，就会得到很高质量的速度。这正是<code>CDN技术</code>的核心。如下图：</p>
<p><img src="/img/nginx/cdn.jpg" alt="CDN原理图"></p>
</div></article></div></main><footer><div class="paginator"><a href="/2016/04/05/%E8%BF%9F%E6%9D%A5%E7%9A%84%E9%9D%A2%E7%BB%8F/" class="prev">PREV</a><a href="/2016/01/04/happy-new-year-to-2016/" class="next">NEXT</a></div><div id="gitment_title" onClick="showGitment()" class="gitment_title">显示评论</div><div id="J_commentContainer" style="display:none;"></div><link rel="stylesheet" href="//imsun.github.io/gitment/style/default.css"><script src="//imsun.github.io/gitment/dist/gitment.browser.js"></script><script>const myTheme = {
    render(state, instance) {
        const container = document.createElement('div');
        container.lang = "en-US";
        container.className = 'gitment-container gitment-root-container';
        container.appendChild(instance.renderHeader(state, instance));
        container.appendChild(instance.renderEditor(state, instance));
        container.appendChild(instance.renderComments(state, instance));
        container.appendChild(instance.renderFooter(state, instance));
        return container;
    }
}
function showGitment() {
    document.querySelector('#gitment_title').style.display = 'none';
    document.querySelector('#J_commentContainer').style.display = 'block';
    document.querySelector('#J_commentContainer').classList.add('gitment_container');
    var gitment = new Gitment({
        id: window.location.pathname,
        theme: myTheme,
        owner: 'cnt1992',
        repo: 'cnt1992.github.io',
        oauth: {
            client_id: '09b981847c8a38e58a62',
            client_secret: '1feb91ebe731e68f89af0e6c43928f5f61d0bbf9'
        }
    });
    gitment.render('J_commentContainer');
}</script><div class="copyright"><p>© 2015 - 2024 <a href="https://cnt1992.github.io">SkyCai</a>, Where there is a will there is a way.</p><p style="display:none !important;"><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span><span id="busuanzi_container_site_uv">本站总访客数<span id="busuanzi_value_site_uv"></span>人次</span></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-75181437-1",'auto');ga('send','pageview');</script><script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>