<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 问题式学习Mock开发 · Web前端爱好者</title><meta name="description" content="问题式学习Mock开发 - SkyCai"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://cnt1992.github.io/atom.xml" title="Web前端爱好者"><meta name="generator" content="Hexo 7.0.0"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/cnt1992" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><span style="display:none !important;"><span id="busuanzi_container_page_pv">本文总阅读量<span id="busuanzi_value_page_pv"></span></span></span><article class="post-block"><h1 class="post-title">问题式学习Mock开发</h1><div class="post-info">2016年9月28日</div><div class="post-content"><blockquote>
<p>本文适合于重构转前端开发或对前后端分离的开发模式尚且没有真正的实践的童鞋，对这套模式有深入实践并且有一套心得的大神欢迎提出更多的建议。</p>
</blockquote>
<span id="more"></span>

<h2 id="问题一：我跟后端约定好了接口的数据格式，接下来我应该怎么进行开发呢？"><a href="#问题一：我跟后端约定好了接口的数据格式，接下来我应该怎么进行开发呢？" class="headerlink" title="问题一：我跟后端约定好了接口的数据格式，接下来我应该怎么进行开发呢？"></a>问题一：我跟后端约定好了接口的数据格式，接下来我应该怎么进行开发呢？</h2><p>这是前后端分离的第一步也是很重要的一步，跟后端约定好了数据格式之后两边可以并行开发而不需要等待另外一方提供真正的接口出来，假设数据格式如下（一般数据都会是<strong>JSON</strong>格式）：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;天哥&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sky&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>前端只要约定好了数据格式那就可以愉快进行开发了，假设用现成的<strong>jQuery</strong>库来开发，核心代码就可以如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">;(<span class="keyword">function</span>(<span class="params">$</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> mockData = &#123;</span><br><span class="line">        <span class="string">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;天哥&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;sky&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;ajax-url&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&#x27;JSON&#x27;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">            <span class="comment">// 由于上面ajax请求的url并不会返回真实数据，所以会直接走到error函数去</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> data = mockData;</span><br><span class="line">            <span class="keyword">if</span> (data.<span class="property">success</span> === <span class="string">&#x27;true&#x27;</span>) &#123;</span><br><span class="line">                <span class="comment">// 其它逻辑开发</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure>

<p>上面代码是<strong>Mock</strong>最简单的方法，当然会存在一些问题，接下来看。</p>
<h2 id="问题二：我的mock数据是比较多的，也写在脚本里面混在一起么？"><a href="#问题二：我的mock数据是比较多的，也写在脚本里面混在一起么？" class="headerlink" title="问题二：我的mock数据是比较多的，也写在脚本里面混在一起么？"></a>问题二：我的mock数据是比较多的，也写在脚本里面混在一起么？</h2><p>你能想到的问题大多数都要解决方案的，对于数据量相对较大而且又需要随机的，那就直接用 <a href="https://github.com/nuysoft/Mock/wiki/Getting-Started">mock</a> 库，语法直接在他们的站点看挺简单的。</p>
<p><strong>Mock</strong>数据最终是不会发布的，所以为了避免后期又需要改动很多代码，建议的做法就是将这些数据移到一个<code>mock</code>文件夹，代码结构可以如下：</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">app</span><br><span class="line"> <span class="string">|- index.html</span></span><br><span class="line"> <span class="string">|- js</span></span><br><span class="line">    <span class="string">|- index.js</span></span><br><span class="line"> <span class="string">|- mock</span></span><br><span class="line">    <span class="string">|- mock.js</span></span><br></pre></td></tr></table></figure>

<p>那么这个时候<code>index.html</code>的代码大致如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>mock demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;mock/mock.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>mock.js</strong>的内容其实就是上面问题一的<code>const mockData = xxx</code>挪过去，而剩下的逻辑就是<code>index.js</code>的内容。</p>
<p>这里延伸一下，<code>&lt;script src=&quot;mock/mock.js&gt;&lt;/script&gt;&quot;</code> 这段代码只在开发环境下才需要引入，而在生产环境是不需要引入的，有没有办法可以自动化根据不同环境引入跟不引入呢？答案是肯定的。这块用<strong>gulp</strong>来做就比较合适了，这里不赘述，如有需要可私下继续讨论。</p>
<h2 id="问题三：我如何直接就写好接口地址并且返回数据写正常逻辑？"><a href="#问题三：我如何直接就写好接口地址并且返回数据写正常逻辑？" class="headerlink" title="问题三：我如何直接就写好接口地址并且返回数据写正常逻辑？"></a>问题三：我如何直接就写好接口地址并且返回数据写正常逻辑？</h2><p>这个时候<code>NodeJs</code>就出场了，后端接口地址给你了，只是没有数据，那就让<code>Node</code>去做这一层代理，给出一个示例：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">9000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> params = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">let</span> content = fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;mock/mockdata.js&#x27;</span>).<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">if</span> (params.<span class="property">query</span> &amp;&amp; params.<span class="property">query</span>.<span class="property">callback</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> str = <span class="string">`<span class="subst">$&#123;params.query.callback&#125;</span>(<span class="subst">$&#123;content&#125;</span>)`</span>;</span><br><span class="line">        res.<span class="title function_">end</span>(str);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">end</span>(content);</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(port, hostname, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`server listen on <span class="subst">$&#123;hostname&#125;</span>:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这个时候只要启动 <code>node app.js</code>，再加上<code>hosts</code>配置，就可以把接口地址匹配到该服务返回数据进行开发了。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2016/12/17/tmall-recruit/" class="prev">PREV</a><a href="/2016/08/26/to-be-a-qualified-front-end-developer/" class="next">NEXT</a></div><div id="gitment_title" onClick="showGitment()" class="gitment_title">显示评论</div><div id="J_commentContainer" style="display:none;"></div><link rel="stylesheet" href="//imsun.github.io/gitment/style/default.css"><script src="//imsun.github.io/gitment/dist/gitment.browser.js"></script><script>const myTheme = {
    render(state, instance) {
        const container = document.createElement('div');
        container.lang = "en-US";
        container.className = 'gitment-container gitment-root-container';
        container.appendChild(instance.renderHeader(state, instance));
        container.appendChild(instance.renderEditor(state, instance));
        container.appendChild(instance.renderComments(state, instance));
        container.appendChild(instance.renderFooter(state, instance));
        return container;
    }
}
function showGitment() {
    document.querySelector('#gitment_title').style.display = 'none';
    document.querySelector('#J_commentContainer').style.display = 'block';
    document.querySelector('#J_commentContainer').classList.add('gitment_container');
    var gitment = new Gitment({
        id: window.location.pathname,
        theme: myTheme,
        owner: 'cnt1992',
        repo: 'cnt1992.github.io',
        oauth: {
            client_id: '09b981847c8a38e58a62',
            client_secret: '1feb91ebe731e68f89af0e6c43928f5f61d0bbf9'
        }
    });
    gitment.render('J_commentContainer');
}</script><div class="copyright"><p>© 2015 - 2024 <a href="https://cnt1992.github.io">SkyCai</a>, Where there is a will there is a way.</p><p style="display:none !important;"><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span><span id="busuanzi_container_site_uv">本站总访客数<span id="busuanzi_value_site_uv"></span>人次</span></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-75181437-1",'auto');ga('send','pageview');</script><script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>